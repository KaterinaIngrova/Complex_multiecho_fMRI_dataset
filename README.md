
**Scripts related to the article Complex multi-echo fMRI dataset: New strategies in processing of multi-echo data**

This repository contains a collection of scripts developed for the article "Complex multi-echo fMRI dataset: New strategies in processing of multi-echo data". The scripts implement a complete processing pipeline - from dataset preparation, preprocessing, quality assessment, and first-level statistical analysis.




The repository can be divided into three main sections:

o **Dataset preparation** - scripts for data conversion and creation of BIDS-compatible event file

o **E-Prime scripts** - E-Prime presentation scripts

o **Data analysis** - scripts for preprocessing of multi-echo data, data quality assessment, and statistical modeling





Below you will find descriptions of all scripts included in this repository:



**Mafil\_dicom2preBIDS**

The Mafil\_dicom2preBIDS\_public function converts DICOM files to NIFTI and organizes the converted data according to BIDS(-like) format. Tailored to MAFIL CEITEC MR data.



**E-Prime\_VisMot**

The E-Prime\_VisMot script implements the VisMot task used during fMRI scanning. It specifies the timing of active and rest blocks, displays stimuli, and records participant responses. The output log files produced by this script serve as input for the EVENT\_VisMot processing script.



**E-Prime\_VOB**

The E-Prime\_VOB script implements the VOB task used during fMRI scanning. It defines the presentation timing and order of stimuli and records participant responses. The output log files produced by this script serve as input for the EVENT\_VOB processing script.



**EVENT\_VisMot**

The EVENT\_VisMot script generates BIDS-compatible event files for the VisMot task. It reads raw log files, extracts relevant trial information (stimulus onset, duration, and trial type), and converts them into a structured .tsv format. The script handles both rest and active blocks, calculates block durations based on TR. The output files are ready for subsequent fMRI analysis and task modeling.



**EVENT\_VOB**

The EVENT\_VOB script creates BIDS-compatible event files for the VOB task. It reads raw log files and extracts trial information (trial type, stimulus, onset, duration, response time, and correctness). Response correctness is automatically determined according to the task rules. The resulting .tsv files are prepared for later modeling of task events in fMRI analyses.



**DQ\_calc**

The DQ\_calc function computes multiple data quality metrics, including temporal signal-to-noise ratio (tSNR), framewise displacement (FD), DVARS, and spatial-to-noise separation (SNS). Results are saved in both .mat and NIfTI formats. This function is part of the DQ\_prep pipeline. The function is designed for automated processing across multiple subjects and sessions.



**FD\_calc**

The FD\_calc function computes Framewise Displacement (FD) as a measure of subject head motion during scanning. It takes a matrix of motion parameters (translations and rotations) and supports several calculation methods via the optional argument fd\_type. This function is part of the DQ\_prep pipeline.



**DQ\_prep**

The DQ\_prep script prepares functional data for quality assessment by ensuring the correct directory structure and calling DQ\_calc and FD\_calc. Outputs are stored in each subject's func/DQoutputs folder.



**FC\_corrmat\_calc**

The FC\_corrmat\_calc function calculates the tSNR and additional signal quality metrics for each region of interest (ROI) in the gray matter, white matter, and cerebrospinal fluid. It supports automatic processing of multiple subjects and sessions. Subject-level results are stored in the FC\_CorrMatrix folder, and a group summary file FCmatrix\_AAL\_tse.mat is saved in the main study directory.



**Process\_MultiEcho**

The Process\_MultiEcho script handles core processing steps specific to multi-echo fMRI data, such as realignment and echo combination. The resulting files are ready for subsequent preprocessing and analysis.



**Preprocess\_MultiEcho**

The Preprocess\_MultiEcho script performs preprocessing of multi-echo fMRI data using SPM12. It automates core preprocessing steps — including coregistration, spatial normalization, and smoothing — ensuring a standardized workflow across all subjects and tasks. This script follows Process\_MultiEcho.



**Statistic\_VOB**

The Statistic\_VOB script performs first-level statistical analysis for the VOB fMRI task using SPM12. It automatically loads preprocessed BOLD data and corresponding event files generated by EVENT\_VOB, defines task conditions, and includes 24 motion regressors. It builds and estimates a subject-level GLM, computes contrasts, and outputs statistical maps. The script supports batch processing of multiple subjects and sessions, ensuring consistent statistical modeling across the dataset and providing a basis for subsequent group-level analysis.



**Statistic\_VisMot**

The Statistic\_VisMot script performs first-subject statistical analysis for the VisMot fMRI task using SPM12. It automatically loads preprocessed BOLD data and corresponding event files generated by EVENT\_VisMot, defines task conditions, and includes 24 motion regressors. It builds and estimates a subject-level GLM, computes contrasts, and outputs statistical maps. The script supports batch processing of multiple subjects and sessions, ensuring consistent statistical modeling across the dataset and providing a basis for subsequent group-level analysis.

